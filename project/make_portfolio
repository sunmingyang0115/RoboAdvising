#Function to produce dataframe portfolio, consumes a dataframe that has tickers as index and stores their chosen weights in a column labelled 'Weight'
def make_portfolio(dataframe):
    #Define Variables
    money = 750000
    flat_fee = 4.95
    i = 0
    
    # Create Empty DataFrame and lists
    Portfolio_Final = pd.DataFrame()
    ticker_lst = [0]*len(dataframe)
    price_lst = [0]*len(dataframe)
    currency_lst = [0]*len(dataframe)
    num_shares_lst = [0]*len(dataframe)
    value_lst = [0]*len(dataframe)
    weight_lst = [0]*len(dataframe)
    index_lst = [0]*len(dataframe)
    
    # Subtract flat fee of purchasing stocks from total investment funds
    money -= flat_fee*len(dataframe)
    
    # Create lists to store data for each ticker
    while i < len(dataframe):
        ticker_lst[i] = dataframe.index[i]
        currency_lst[i] = yf.Ticker(ticker_lst[i]).fast_info['currency']      
        # If stock currency is in USD, convert price to CAD
        if currency_lst[i]=='USD':
            price_lst[i] = USD_to_CAD_converter(yf.Ticker(ticker_lst[i]).history().loc[closing_date, 'Close'])
        else:
            price_lst[i] = yf.Ticker(ticker_lst[i]).history().loc[closing_date, 'Close']
        num_shares_lst[i] = (money*dataframe.loc[ticker_lst[i], 'Weight'])/price_lst[i]
        value_lst[i] = num_shares_lst[i]*price_lst[i]
        weight_lst[i] = dataframe.loc[ticker_lst[i], 'Weight']
        index_lst[i] = i+1
        i += 1
    
    # Create DataFrame with required stock information
    Portfolio_Final['Ticker'] = ticker_lst
    Portfolio_Final['Price'] = price_lst
    Portfolio_Final['Currency'] = currency_lst
    Portfolio_Final['Shares'] = num_shares_lst
    Portfolio_Final['Value'] = value_lst
    Portfolio_Final['Weight'] = weight_lst
    Portfolio_Final['Total Weight'] = Portfolio_Final.Weight.sum()
    Portfolio_Final['Total Value'] = Portfolio_Final.Value.sum() + flat_fee*len(dataframe)
    
    #Change index of portfolio
    Portfolio_Final.set_index(pd.Series(index_lst), inplace = True)
    
    return Portfolio_Final
